---
import { API_BASE_URL } from "astro:env/server"
import axios from "axios"
export async function getStaticPaths() {
    try{
        // Fetch slugs
        const { data } = await axios.get(`${API_BASE_URL}/items`)
        const arr = Array.from({ length: data.length }, (_, i) => data[i]._id)

        const slugs = [
            ...arr
        ]

        // Fetch details for each slug
        const paths = await Promise.all(
            slugs.map(async (slug) => {
                try {
                    const response: any = await axios.get(`${API_BASE_URL}/items/${slug}`)
                    return {
                        params: {slug},
                        props: {data: response.data, slugs}
                    }
                } catch (err: any) {
                    console.error(`Failed to fetch details for slug: ${slug}`),
                    err.message
                }
                return { params: {slug}, props: {data: null, slugs}}
            })
        )
        return paths
    } catch(err: any) {
        console.error('Failed to fetch random slugs:', err.message)
        return []
    }
}
 
const {data} = Astro.props
const {slug} = Astro.params
---
{data && <div>
    <h1>{data._id}</h1>
    <h2>{data.name}</h2>
    <p>{data.description}</p>
</div>}